<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.easyPoint.dao.business.GoodsDao">
    <!-- 添加商品 -->
    <insert id="addGoods" parameterType="goods">
        INSERT INTO goods_table(good_id, good_name, business_name, lowest_price, highest_price, good_images, deposit,
                                deposit_instruction, take_good_instruction, return_good_instruction, business_hours,
                                good_description, lease_num, pro_img, goods_type_id, state)
        VALUES (#{goodId}, #{goodName}, #{businessName}, #{lowestPrice}, #{highestPrice}, #{goodImages}, #{deposit},
                #{depositInstruction}, #{takeGoodInstruction}, #{returnGoodInstruction}, #{businessHours},
                #{goodDescription}, #{leaseNum}, #{proImg}, #{goodsTypeId}, #{state})
    </insert>

    <!-- 根据状态查询已发布过的所有商品 -->
    <select id="findGoodsByState" parameterType="Integer" resultType="goodsDto">
        SELECT good_id       AS goodId,
               good_name     AS goodName,
               lowest_price  AS lowestPrice,
               highest_price AS highestPrice,
               pro_img       AS proImg,
               business_name AS businessName,
               lease_name    AS leaseName
        FROM goods_table
        WHERE state = #{state}
    </select>

    <!-- 根据id修改商品状态 -->
    <update id="updateStateById" parameterType="string">
        UPDATE goods_table
        SET state = #{state}
        WHERE good_id = #{goodId}
    </update>

    <!-- 根据id查询商品详情 -->
    <select id="findGoodsDetailsById" parameterType="string" resultType="goodsDetailsDto">
        SELECT good_name               AS goodName,
               business_name           AS businessName,
               lowest_price            AS lowestPrice,
               highest_price           AS highestPrice,
               deposit_instruction     AS depositInstruction,
               take_good_instruction   AS takeGoodInstruction,
               return_good_instruction AS returnGoodInstruction,
               lease_num               AS leaseNum,
               pro_img                 AS proImg
        FROM goods_table
    </select>

    <!-- 根据id删除商品 -->
    <delete id="deleteGoodsById" parameterType="string">
        DELETE
        FROM goods_table
        WHERE good_id = #{goodId}
    </delete>

    <!-- 根据Id查询某商品是否存在 -->
    <select id="findGoodsById" parameterType="string" resultType="string">
        SELECT state
        FROM goods_table
        WHERE good_id = #{goodId}
    </select>

    <!--  修改商品信息 -->
    <update id="updateGoods" parameterType="goods">
        UPDATE goods_table
        <set>
            <if test="goodName != null and goodName != ''">good_name = #{goodName}</if>
            <if test="businessName != null and businessName != ''">business_name = #{businessName}</if>
            <if test="lowestPrice != null and lowestPrice >= 0">lowest_price = #{lowestPrice}</if>
            <if test="highestPrice != null and highestPrice >= 0">highest_price = #{highestPrice}</if>
            <if test="goodImages !=  null and goodImages != ''">good_images = #{goodImages}</if>
            <if test="deposit != null and deposit >= 0">deposit = #{deposit}</if>
            <if test="depositInstruction != null depositInstruction != ''">deposit_instruction</if>
            <if test="takeGoodInstruction != null takeGoodInstruction != ''">take_good_instruction</if>
            <if test="returnGoodInstruction != null returnGoodInstruction != ''">return_good_instruction</if>
            <if test="businessHours != null businessHours != ''">business_hours</if>
            <if test="goodDescription != null goodDescription != ''">good_description</if>
            <if test="proImg != null proImg != ''">pro_img</if>
            <if test="goodsTypeId != null goodsTypeId != ''">goods_type_id</if>
        </set>
        WHERE good_id = #{goodId}
    </update>
</mapper>