<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.user.dao.UserGoodsDao">
 
 	 
 	 <!--
 	<select id="selectAllGoods" resultMap="GoodsAndVariety">
        SELECT t1.*,t2.goodId VgoodId,t2.varietyId,t2.variety,t2.price VPrice,t2.inventory,t2.img VImg FROM
                  goodsTable t1,
                  goodsVariety t2
            WHERE t1.goodId = t2.goodId
    </select> 
    <resultMap type="Goods" id="GoodsAndVariety">
        <id column="goodId" property="goodId"/>
        <result column="goodName" property="goodName"/>
        <result column="goodTitle" property="goodTitle"/>
        <result column="freight" property="freight"/>
         <result column="lowPrice" property="lowPrice"/>
         <result column="img" property="img"/>
         <result column="detailsInfo" property="detailsInfo"/>
         
     -->
         <!-- 关联
         <collection property="varieties" ofType="GoodsVariety">
            <id column="VgoodId" property="goodId"/>
             <result column="varietyId" property="varietyId"/>
             <result column="variety" property="variety"/>
             <result column="VPrice" property="price"/>
             <result column="inventory" property="inventory"/>
             <result column="VImg" property="img"/>
         </collection>
    </resultMap> 
	 -->
 	
 	<select id="selectRecent_Hot" resultType="String">
        SELECT goodId FROM recenthot
    </select>
 	
 	<select id="selectRecent_Hot_Goods" resultType="Goods" >
 		select * from goodsTable where goodId in
     	<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
             #{item}       
        </foreach>    
 	</select>
 	<select id="selectTypeGoods" parameterType="String" resultType="Goods">
 		<bind name="typeLike" value="'%'+type+'%'"/>
 		select * from goodsTable  where type like #{typeLike}
 	</select>
 	
 	<select id="selectAllVariety" parameterType="String" resultType="GoodsVariety">
 		select * from GoodsVariety where goodId = #{goodId}
 	</select>
 	
 	<select id="selectCollectionByUidAndGoodId" resultType="String">
 		select goodId from usercollection where uid = #{uid} and goodId = #{goodId} 
 	</select>
 	
 	<!-- 收藏或取消商品sign为1或-1 -->
 	<update id="updateCollection">
 		update goodsTable set collection = collection + #{sign} where goodId = #{goodId}
 	</update>
 	
 	<!-- 将商品放入用户的收藏表中 -->
 	<insert id="insertGoodInUserCollection">
 		insert into userCollection value (#{uid},#{goodId});
 	</insert>
 	
 	<!-- 将商品从用户收藏表中删除 -->
 	<delete id="deleteGoodFromUserCollection">
 		delete from userCollection where uid = #{uid} and goodId = #{goodId};
 	</delete>
 	
 	<!-- 增加浏览量 -->
 	<update id="addBrowse">
 		update goodsTable set browse = browse + #{number} where goodId = #{goodId}
 	</update>
 	
 	<!-- 查询该商品规格 -->
 	<select id="selectVariety" resultType="GoodsVariety">
 		select * from GoodsVariety where varietyId = #{varietyId}
 	</select>
 	
 	<!-- 修改库存 -->
 	<update id="updateInventory">
 		update GoodsVariety set inventory = inventory - #{number},version = version+1 
 		where varietyId = #{varietyId}
 		and version = #{version}
 	</update>
 </mapper>