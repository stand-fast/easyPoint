<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.user.dao.OrderDao">
 <!-- 
 	//添加订单
	public void addOrder(Order order);
	
	//查询订单
	public List<Order> selectUserOrder(String uId,String state);
 
  -->
  	<insert id="addOrder" parameterType="Order">
  		insert into ordersTable (orderId,uid,goodId,varietyId,addressId,number,totalPrice,startTime,refund,state)value (#{orderId},#{uid},#{goodId},#{varietyId},#{addressId},#{number},#{totalPrice},#{startTime},0,1
  									   )
  	</insert>
  	
  	<select id="selectUserOrder" resultMap="orderInfo">
  		select o.* , 
  			   g.goodId GgoodId,g.goodName,g.detailsInfo,g.pro_img, 
  		       v.goodId VgoodId,v.varietyId,v.variety,
  		       a.*,
  		       j.logo,j.companyName
  			   from ordersTable o,goodsTable g,GoodsVariety v,userAddress a,joinedBusiness j
  						where o.uid = #{uid} 
  						and o.goodId = g.goodId
  						and o.varietyId = v.varietyId
  						and o.addressId = a.addressId
  						and g.merchantId = j.merchantId
  	</select>
  	
  	<resultMap type="Order" id="orderInfo">
        <id column="orderId" property="orderId"/>
        <id column="merchantId" property="merchantId"/>
        <result column="uid" property="uid"/>
        <result column="goodId" property="goodId"/>
        <result column="varietyId" property="varietyId"/>
        <result column="addressId" property="addressId"/>
        <result column="number" property="number"/>
        <result column="totalPrice" property="totalPrice"/>
        <result column="startTime" property="startTime"/>
        <result column="deliveryTime" property="deliveryTime"/>
        <result column="receiveTime" property="receiveTime"/>
        <result column="finishTime" property="finishTime"/>
        <result column="refund" property="refund"/>
        <result column="state" property="state"/>
        <result column="logo" property="logo"/>
        <result column="companyName" property="companyName"/>
		
		<association property="good" javaType="Goods">
			<id column="GgoodId" property="goodId"/>
        	<result column="goodName" property="goodName"/>
        	<result column="detailsInfo" property="detailsInfo"/>
        	<result column="pro_img" property="pro_img"/>
		</association>
		
		<association property="variety" javaType="GoodsVariety">
			<id column="varietyId" property="varietyId"/>
        	<result column="variety" property="variety"/>
		</association>
		
		<association property="address" javaType="userAddress">
			<id column="addressId" property="addressId"/>
			<result column="username" property="username"/>
			<result column="sex" property="sex"/>
            <result column="phonenumber" property="phonenumber"/>
            <result column="address" property="address"/>
		</association>
    </resultMap> 
  	
 </mapper>